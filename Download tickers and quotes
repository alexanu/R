BORSE <- c("NYSE","NASDAQ","AMEX")
urls <- c("http://www.nasdaq.com/screening/companies-by-name.aspx?letter=0&exchange=nyse&render=download",
          "http://www.nasdaq.com/screening/companies-by-industry.aspx?exchange=NASDAQ&render=download",
          "http://www.nasdaq.com/screening/companies-by-name.aspx?letter=0&exchange=amex&render=download")
BORSE_URL <- data.frame(BORSE, urls, stringsAsFactors=F)
BORSE_URL$urls


library(data.table)
datalist<-NULL # clear datalist (just in case)
datalist = lapply(BORSE_URL$urls, #creates list: reads all  the txt file from the folder and every dataframe in separate list componentassuming tab separated values with a header   
                  FUN=fread, # fread from the package "DATA.TABLE" does it much faster than read.table (standard functionality). The comparison of time could be done using function system.time(x), where x is our expression
                  header=TRUE)
datalist <- mapply(cbind, datalist , "Borse"=BORSE_URL$BORSE , SIMPLIFY=F) # add new column to every data.table in the list and fills it with the symbol
datatb = rbindlist(datalist, fill=TRUE) # merging rows
datatb[Borse=="NASDAQ",industry:=Industry]
setnames(datatb, make.names(colnames(datatb))) # this remove spaces from column names
datatb[,c("LastSale","Summary.Quote","V9","ADR.TSO","Industry","V10"):=NULL]


datatb$Symbol[sample(1:length(datatb$Symbol),10,replace=T)]



Test_Tickers <- datatb$Symbol[sample(1:length(datatb$Symbol),10,replace=T)]
url_ticker <- paste0("http://chart.finance.yahoo.com/table.csv?s=",
               	   Test_Tickers,
			   "&a=11&b=16&c=2016&d=0&e=16&f=2017&g=d&ignore=.csv")
Path <- paste0("L:\\AGCS\\CFO\\Metadata\\For 2013\\Weight table\\",Test_Tickers,".csv")
download.file(url_ticker, destfile = Path)


lapply(Test_Tickers,
	 function(x) download.file(paste0("http://chart.finance.yahoo.com/table.csv?s=",
               	  			    x,
			   			    "&a=11&b=16&c=2016&d=0&e=16&f=2017&g=d&ignore=.csv"),
					   destfile = paste0("L:\\AGCS\\CFO\\Metadata\\For 2013\\Weight table\\",
								   x,
								   ".csv")
					    )
	)



"SCE^D" 

datatb[,.N,by=.(Borse,Industry)]
